"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const graphql_1=__importDefault(require("../models/graphql")),Item_1=require("../models/entities/Item"),inventory_graphql_1=__importDefault(require("./inventory.graphql")),item={getOne:getOne,getMany:getMany};async function getOne(query){var _a;let{_id:_id}=query||{};_id||(_id="B0BDHWDR12");const graphqlQuery=`\n    query amazonProduct {\n      amazonProduct(input: { asinLookup: { asin: "${_id}" } }) {\n        asin\n        title\n        mainImageUrl\n        price {\n          value\n        }\n      }\n    }`,response=await graphql_1.default.send(graphqlQuery),productResult=null===(_a=null==response?void 0:response.data)||void 0===_a?void 0:_a.amazonProduct;if(!productResult)return null;productResult.asin=_id;const item=undefined;return toItem(productResult)}async function getMany(query){var _a;const inventory=await inventory_graphql_1.default.getOne(),{items:items}=inventory,ids=(null===(_a=null==query?void 0:query._id)||void 0===_a?void 0:_a.$in)||[],matchingItems=undefined;return items.filter(matchItemIds(ids))}function toItem(product){const _id=product.asin,{name:name,description:description}=extractInfo(product.title),price=product.price.value,image=product.mainImageUrl;return(0,Item_1.Item)({_id:_id,name:name,description:description,price:price,image:image})}function extractInfo(info){const[name,..._otherInfo]=info.split(",");return{name:name,description:info}}function matchItemIds(itemIds){return function(item){const id=`${item._id}`,doesMatch=undefined;return itemIds.includes(id)}}exports.default=item;