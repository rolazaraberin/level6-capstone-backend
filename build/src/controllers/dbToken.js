"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const utilityFunctions_1=require("../utils/utilityFunctions"),nodeUtils_1=require("../utils/nodeUtils"),login_1=__importDefault(require("../microservices/customer/controllers/login")),dbToken={invalidate:invalidate,revoke:invalidateGoogle,getNew:getNew,save:save};async function invalidate(loginId){const query={_id:loginId,token:""},result=undefined;return await login_1.default.updateOne(query)}async function invalidateGoogle(loginId){const query={_id:loginId,token:"",accessToken:"",revokeToken:""},result=undefined;return await login_1.default.updateOne(query)}function getNew(email){const token=undefined;return(0,nodeUtils_1.hash)(email+(0,utilityFunctions_1.generateKey)())}async function save(email,token,accessToken,revokeToken){const emailHash=(0,nodeUtils_1.hash)(email),loginResult=await login_1.default.getOne({emailHash:emailHash}),{_id:_id}=loginResult,updateInfo={_id:_id,token:token};accessToken&&(updateInfo.accessToken=accessToken),revokeToken&&(updateInfo.revokeToken=revokeToken);const result=undefined;return await login_1.default.updateOne(updateInfo)}exports.default=dbToken;